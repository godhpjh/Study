
# JPA (Java Persistence API)
<img src="./img/flow.png" alt="jpa_flow" width="80%" style="margin-left: auto; margin-right: auto; display: block;"/>

- 자바 ORM(Object-relational mapping) 기술의 표준 명세
- 자바 어플리케이션에서 관계형 데이터베이스를 사용하는 방식을 정의한 인터페이스
- 기존 EJB에서 제공되던 엔티티 빈을 대체하는 기술
- 자바 클래스와 DB테이블을 매핑




***

## 문법

### @Entity
- 데이타베이스의 <b>테이블과 일대일로 매칭되는 객체 단위</b>
- Entity 객체의 인스턴스 하나가 테이블에서 하나의 레코드 값
- 먼저 Spring Boot 를 설정할때 spring.jpa.hibernate.ddl-auto 설정이 create 혹은 update 로 되어 있을 경우 Spring 프로젝트가 시작될때 <b>EntityManager 가 자동으로 DDL 을 수행해 테이블을 생성</b>
- name 속성을 이용해 데이타베이스상의 실제 테이블 명칭을 지정하지 않는다면 Entity 클래스의 이름 그대로 CamelCase 를 유지한채 테이블이 생성
- <b>UnderScore 를 이용한 테이블 명명 규칙</b>을 이용하는 것이 좋습니다

```java
@Entity
public class Organization {
    ...
}

@Entity(name = "employee")
public class Employee {
    ...
}

@Entity(name = "employee_address")
public class EmployeeAddress {
    ...
}
```


### @Column
- <b>데이타베이스의 테이블에 있는 컬럼과 동일하게 1:1로 매칭</b>되기 때문에 Entity 클래스안에 내부변수로 정의
- Entity 클래스에 정의된 모든 내부변수는기본적으로 @Column 어노테이션을 포함
- Spring Boot 의 spring.jpa.hibernate.ddl-auto 설정이 create 혹은 update 로 되어 있을 경우 create 일때는 최초에 한번 컬럼이 생성이 되고, update 일때는 Entity 클래스에 있지만 해당 테이블에 존재하지 않는 컬럼을 추가로 생성
- UnderScore 형식으로 name 을 명시적으로 작성 
```java
@Column 
private String code;

@Column(length = 100)
private String name;

//@Column 은 생략이 가능합니다.
private String description; 

@Column(precision = 11, scale = 2)
private BigDecimal amount;

@Column
private Integer size;

@Column(name ="register_date")
private LocalDateTime registerDate;
```

### @Id
- <b>PK (Primary Key)</b>
- Entity 클래스 상에 해당 PK 를 명시적으로 표시를 해야 되는데 그것을 @Id 어노테이션을 이용해 이것이 PK 임을 지정
```java
@Id
@Column
private String code;
```

### @GeneratedValue
- 데이타 경합으로 인해 발생되는 데드락 같은 현상을 방지 하기 위해 대부분 BigInterger 즉 Java 의 Long 을 주로 사용

- <b>auto increment</b>
    - 숫자형의 PK 컬럼 속성을 auto increment 로 지정하면 자동으로 새로운 레코드가 생성이 될때마다 마지막 PK 값에서 자동으로 +1 을 해주는 방식
    - <b>GenerationType.IDENTITY</b> 로 지정해 auto increment 컬럼인 것을 EntityManager 에 알려줍니다.
    ```java
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    ```
- <b>sequence</b>
    - sequence ORACLE 객체를 생성해 두고 해당 sequence 를 호출할때마다 기존 값의 +1 이 된 값을 반환해 주는 방식
    - <b>GenerationType.SEQUENCE</b> 로 지정해 sequence 를 사용해 PK 값을 사용하겠다고 지정
    ```java
    @Id
    @SequenceGenerator(name="seq", sequenceName="jpa_sequence")
    @GeneratedValue(strategy=GenerationType.SEQUENCE, generator="seq")
    private Long id;
    ```

### @EmbeddedId

### @Enumerated

### @Transient


***

## 참고 사이트

https://velog.io/@adam2/JPA%EB%8A%94-%EB%8F%84%EB%8D%B0%EC%B2%B4-%EB%AD%98%EA%B9%8C-orm-%EC%98%81%EC%86%8D%EC%84%B1-hibernate-spring-data-jpa
(개념)

https://jogeum.net/6
(문법)